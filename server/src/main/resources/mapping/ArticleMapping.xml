<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org//dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhumingbei.techblog.mapper.ArticleMapper">

    <resultMap id="ArticleMap" type="com.zhumingbei.techblog.bean.ArticleBean">
        <id column="id" property="id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="authorID" column="author_id" />
        <result property="collectedNums" column="collected_nums" />
        <result property="likedNums" column="liked_nums" />
        <result property="recommendedNums" column="recommendedNums" />
        <result property="commentNums" column="comment_nums" />
        <result property="updatedTime" column="updated_time_format" />
        <result property="createdTime" column="created_time_format" />
        <association property="author" column="author_id"  resultMap="AuthorMap" />
    </resultMap>

    <resultMap id="AuthorMap" type="com.zhumingbei.techblog.bean.UserBean">
        <id property="id" column="author_id" />
        <result property="username" column="username"/>
    </resultMap>
    <select id="selectAll" resultMap="ArticleMap">
        select a.id, a.title, a.content, a.liked_nums, a.recommended_nums, a.collected_nums, a.comment_nums, date_format(a.updated_time, '%Y-%m-%d %H:%i:%s') as updated_time_format, date_format(a.created_time, '%Y-%m-%d %H:%i:%s') as created_time_format, a.author_id, u.username
        from article a
        inner join user u on u.id = a.author_id
        order by a.id desc
        limit 20
    </select>

    <insert id="insert" keyProperty="id" useGeneratedKeys="true" parameterType="articleBean">
        insert into article (title, content, author_id) values(#{title}, #{content}, #{authorID})
    </insert>

    <select id="selectByID" resultMap="ArticleMap">
        select a.id, a.title, a.content, a.liked_nums, a.recommended_nums, a.collected_nums, a.comment_nums, date_format(a.updated_time, '%Y-%m-%d %H:%i:%s') as updated_time_format, date_format(a.created_time, '%Y-%m-%d %H:%i:%s') as created_time_format, a.author_id, u.username
        from article a
        inner join user u on u.id = a.author_id
        where a.id = #{articleID}
    </select>
</mapper>